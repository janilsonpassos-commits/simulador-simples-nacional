<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Simulador de Anexos Senhor Contábil</title>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      padding: 20px;
      background: #f8f9fa;
      max-width: 1300px;
      margin: 0 auto;
      color: #333;
    }

    h1 {
      text-align: center;
      color: #2c3e50;
      margin-bottom: 30px;
    }

    .form-container {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 25px;
    }

    .input-group {
      margin-bottom: 15px;
      display: flex;
      align-items: center;
      flex-wrap: wrap;
    }

    label {
      display: inline-block;
      width: 200px;
      font-weight: 600;
      margin-right: 10px;
    }

    input[type="number"] {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 200px;
      font-size: 16px;
    }

    .option-group {
      display: flex;
      gap: 15px;
      margin-left: 15px;
      flex-wrap: wrap;
    }

    .option-item {
      display: flex;
      align-items: center;
      gap: 5px;
      padding: 8px 12px;
      background: #f0f0f0;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .option-item input[type="checkbox"] {
      margin: 0;
    }

    .option-item label {
      width: auto;
      font-weight: normal;
      cursor: pointer;
      margin-right: 0;
    }

    .option-item:hover {
      background: #e0e0e0;
    }

    .option-item input:checked + label {
      font-weight: 600;
    }

    /* Estilos das abas */
    .tabs-container {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-top: 20px;
    }

    .tabs-header {
      display: flex;
      background: #f8f9fa;
      border-radius: 8px 8px 0 0;
      overflow-x: auto;
    }

    .tab-button {
      flex: 1;
      min-width: 150px;
      padding: 15px 10px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 14px;
      font-weight: 600;
      color: #666;
      border-bottom: 3px solid transparent;
      transition: all 0.3s;
      white-space: nowrap;
      position: relative;
    }

    .tab-button:hover {
      background: #e9ecef;
      color: #333;
    }

    .tab-button.active {
      background: white;
      color: #3498db;
      border-bottom-color: #3498db;
    }

    .tabs-content {
      padding: 20px;
    }

    .tab-panel {
      display: none;
    }

    .tab-panel.active {
      display: block;
    }

    .anexo-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid #ecf0f1;
    }

    .anexo-title {
      font-size: 24px;
      font-weight: 700;
      color: #2c3e50;
    }

    .anexo-subtitle {
      font-size: 16px;
      color: #7f8c8d;
      margin-top: 5px;
    }

    .aliquota-badge {
      background: #3498db;
      color: white;
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 600;
    }

    .results-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .result-card {
      background: #f8f9fa;
      border-radius: 8px;
      padding: 20px;
      border-left: 4px solid #3498db;
    }

    .result-card.special {
      background: #fff3cd;
      border-left-color: #ffc107;
    }

    .result-label {
      font-size: 14px;
      color: #666;
      margin-bottom: 5px;
      font-weight: 500;
    }

    .result-value {
      font-size: 18px;
      font-weight: 700;
      color: #2c3e50;
    }

    .result-value.irrf-value {
      color: #c0392b;
    }

    .result-value.gain-value {
      color: #27ae60;
    }

    .result-value.loss-value {
      color: #e74c3c;
    }

    .result-value.zero-diff-value {
      color: #333;
    }

    .total-card {
      grid-column: 1 / -1;
      background: #e8f5e8 !important;
      border-left-color: #27ae60 !important;
      text-align: center;
      padding: 25px;
    }

    .total-card .result-label {
      font-size: 16px;
      color: #27ae60;
    }

    .total-card .result-value {
      font-size: 28px;
      color: #27ae60;
    }

    .comparison-note {
      background: #e3f2fd;
      border: 1px solid #bbdefb;
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
      font-size: 14px;
      color: #1565c0;
    }

    .section-title {
      font-weight: 600;
      color: #2c3e50;
      margin-top: 10px;
      text-align: left;
    }

    .small-info {
      font-size: 12px;
      color: #95a5a6;
      font-style: italic;
      text-align: center;
      margin-top: 30px;
    }

    @media (max-width: 768px) {
      label {
        width: 100%;
        margin-bottom: 5px;
      }
      
      .input-group {
        flex-direction: column;
        align-items: flex-start;
      }
      
      input[type="number"] {
        width: 100%;
      }
      
      .option-group {
        margin-left: 0;
        width: 100%;
      }

      .tabs-header {
        flex-wrap: wrap;
      }

      .tab-button {
        min-width: calc(50% - 5px);
        font-size: 12px;
        padding: 12px 8px;
      }

      .results-grid {
        grid-template-columns: 1fr;
      }

      .anexo-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <h1>Simulador de Anexos Senhor Contábil</h1>

  <div class="form-container">
    <div class="input-group">
      <label for="faturamento">Faturamento Mensal (R$):</label>
      <input type="number" id="faturamento" value="0" min="0" step="100">
    </div>

    <div class="input-group">
      <label for="prolabore">Pró-labore (R$):</label>
      <input type="number" id="prolabore" value="0" min="0" step="100">
    </div>

    <div class="input-group">
      <label>Opções de Pró-labore:</label>
      <div class="option-group">
        <div class="option-item">
          <input type="checkbox" id="opcaoMinimo" name="prolaboreOption" value="minimo">
          <label for="opcaoMinimo">Salário mínimo (R$ 1.518,00)</label>
        </div>
      </div>
    </div>
  </div>

  <div class="section-title">Análise Comparativa entre Anexos</div>

  <div class="tabs-container">
    <div class="tabs-header" id="tabsHeader">
      <button class="tab-button active" data-tab="anexoI">
        Anexo I<br><small>Comércio</small>
      </button>
      <button class="tab-button" data-tab="anexoIII">
        Anexo III<br><small>Serviços</small>
      </button>
      <button class="tab-button" data-tab="anexoIV">
        Anexo IV<br><small>Advocacia, etc.</small>
      </button>
      <button class="tab-button" data-tab="anexoV">
        Anexo V<br><small>Serviços Técnicos</small>
      </button>
      <button class="tab-button" data-tab="anexoVFatorROtimizado">
        Anexo V<br><small>Fator R Otimizado</small>
      </button>
    </div>

    <div class="tabs-content">
      <div id="anexoI" class="tab-panel active">
        <div class="anexo-header">
          <div>
            <div class="anexo-title">Anexo I - Comércio</div>
            <div class="anexo-subtitle">Atividades de comércio em geral</div>
          </div>
          <div class="aliquota-badge" id="aliquotaAnexoI">4,0%</div>
        </div>
        <div class="results-grid" id="resultadosAnexoI"></div>
      </div>

      <div id="anexoIII" class="tab-panel">
        <div class="anexo-header">
          <div>
            <div class="anexo-title">Anexo III - Serviços</div>
            <div class="anexo-subtitle">Prestação de serviços em geral</div>
          </div>
          <div class="aliquota-badge" id="aliquotaAnexoIII">6,0%</div>
        </div>
        <div class="results-grid" id="resultadosAnexoIII"></div>
      </div>

      <div id="anexoIV" class="tab-panel">
        <div class="anexo-header">
          <div>
            <div class="anexo-title">Anexo IV - Advocacia e Similares</div>
            <div class="anexo-subtitle">Serviços advocatícios e correlatos</div>
          </div>
          <div class="aliquota-badge" id="aliquotaAnexoIV">4,5% + CPP 20%</div>
        </div>
        <div class="results-grid" id="resultadosAnexoIV"></div>
      </div>

      <div id="anexoV" class="tab-panel">
        <div class="anexo-header">
          <div>
            <div class="anexo-title">Anexo V - Serviços Técnicos</div>
            <div class="anexo-subtitle">Serviços técnicos e profissionais</div>
          </div>
          <div class="aliquota-badge" id="aliquotaAnexoV">15,5%</div>
        </div>
        <div class="results-grid" id="resultadosAnexoV"></div>
      </div>

      <div id="anexoVFatorROtimizado" class="tab-panel">
        <div class="anexo-header">
          <div>
            <div class="anexo-title">Anexo V - Fator R Otimizado</div>
            <div class="anexo-subtitle">Com aplicação do Fator R (28% do faturamento)</div>
          </div>
          <div class="aliquota-badge" id="aliquotaAnexoVFatorROtimizado">6,0% (Fator R)</div>
        </div>
        <div class="results-grid" id="resultadosAnexoVFatorROtimizado"></div>
        <div class="comparison-note">
          <strong>Comparação com Anexo V Original:</strong>
          <div id="comparacaoFatorR" style="margin-top: 10px; font-size: 16px; font-weight: 600;"></div>
        </div>
      </div>
    </div>
  </div>

  <p class="small-info">
    Valores calculados com base nas alíquotas do Simples Nacional vigentes em 2025.
    O Anexo IV requer pagamento adicional de 20% de CPP patronal sobre o pró-labore.
    IRRF calculado com base no desconto simplificado de R$ 607,20 (projeção 2025) sobre o pró-labore.
    Esta é apenas uma simulação e não substitui a consulta a um contador.
  </p>

  <script>
    // Constantes para o cálculo
    const SALARIO_MINIMO = 1518.00;
    const DESCONTO_SIMPLIFICADO_IRRF = 607.20;

    // Alíquotas do Simples Nacional para cada anexo
    const ALIQUOTAS_SIMPLES = {
      anexoI: 0.04,
      anexoIII: 0.06,
      anexoIV: 0.045,
      anexoV: 0.155
    };

    // Tabela progressiva do IRPF para cálculo do IRRF
    const TABELA_IRPF = [
        { limite: 2259.20, aliquota: 0, parcelaDeduzir: 0 },
        { limite: 2826.65, aliquota: 0.075, parcelaDeduzir: 169.44 },
        { limite: 3751.05, aliquota: 0.15, parcelaDeduzir: 394.16 },
        { limite: 4664.68, aliquota: 0.225, parcelaDeduzir: 662.77 },
        { limite: Infinity, aliquota: 0.275, parcelaDeduzir: 896.00 }
    ];

    // Controle das abas
    let abaAtiva = 'anexoI';

    // Inicializa as abas
    function inicializarAbas() {
      const botoes = document.querySelectorAll('.tab-button');
      const paineis = document.querySelectorAll('.tab-panel');

      botoes.forEach(botao => {
        botao.addEventListener('click', () => {
          const tabId = botao.dataset.tab;
          
          // Remove active de todos os botões e painéis
          botoes.forEach(b => b.classList.remove('active'));
          paineis.forEach(p => p.classList.remove('active'));
          
          // Ativa o botão e painel selecionados
          botao.classList.add('active');
          document.getElementById(tabId).classList.add('active');
          
          abaAtiva = tabId;
        });
      });
    }

    /**
     * Formata um valor numérico para o formato de moeda brasileira (R$).
     */
    function formatarMoeda(valor) {
      return 'R$ ' + valor.toFixed(2).replace('.', ',').replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    /**
     * Calcula o IRRF sobre o pró-labore bruto.
     */
    function calcularIRRF(prolaboreBruto) {
        let baseCalculoIRRF = prolaboreBruto - DESCONTO_SIMPLIFICADO_IRRF;
        if (baseCalculoIRRF < 0) baseCalculoIRRF = 0;

        let irrf = 0;
        let aliquotaAplicada = 0;

        for (const faixa of TABELA_IRPF) {
            if (baseCalculoIRRF <= faixa.limite) {
                irrf = (baseCalculoIRRF * faixa.aliquota) - faixa.parcelaDeduzir;
                aliquotaAplicada = faixa.aliquota;
                break;
            }
        }
        if (aliquotaAplicada === 0) irrf = 0;
        return Math.max(0, irrf);
    }

    /**
     * Calcula os detalhes financeiros para um anexo específico.
     */
    function calcularAnexoDetalhado(faturamento, prolaboreBruto, aliquotaDasSimples, tipoAnexo) {
      const inss = prolaboreBruto * 0.11;
      const cppPatronal = tipoAnexo === "anexoIV" ? (prolaboreBruto * 0.20) : 0;
      const irrf = calcularIRRF(prolaboreBruto);
      const prolaboreLiquido = prolaboreBruto - inss - irrf;
      const das = faturamento * aliquotaDasSimples;
      const despesasTotaisEmpresa = prolaboreBruto + das + cppPatronal;
      const lucroDistribuivel = faturamento - despesasTotaisEmpresa;
      const totalLiquidoSocio = prolaboreLiquido + Math.max(0, lucroDistribuivel);

      return {
        prolaboreBruto, 
        inss, 
        irrf, 
        cppPatronal, 
        prolaboreLiquido, 
        das,
        lucro: Math.max(0, lucroDistribuivel), 
        totalLiquido: totalLiquidoSocio
      };
    }

    /**
     * Atualiza toda a interface das abas com os resultados calculados.
     */
    function atualizarInterfaceAbas(resultados) {
      // Atualiza o conteúdo de cada aba
      Object.entries(resultados).forEach(([anexo, resultado]) => {
        atualizarAbaAnexo(anexo, resultado);
      });

      // Atualiza a comparação do Fator R
      atualizarComparacaoFatorR(resultados);
    }

    /**
     * Atualiza o conteúdo de uma aba específica.
     */
    function atualizarAbaAnexo(anexoId, resultado) {
      const container = document.getElementById(`resultados${anexoId.charAt(0).toUpperCase() + anexoId.slice(1)}`);
      if (!container) return;

      container.innerHTML = '';

      // Define os campos a serem exibidos
      const campos = [
        { label: 'Pró-labore Bruto', campo: 'prolaboreBruto' },
        { label: 'INSS (11%)', campo: 'inss' },
        { label: 'IRRF sobre Pró-labore', campo: 'irrf', classe: 'irrf-value' },
        { label: 'Pró-labore Líquido', campo: 'prolaboreLiquido' },
        { label: 'DAS', campo: 'das' },
        { label: 'Distribuição de Lucros', campo: 'lucro' }
      ];

      // Adiciona CPP Patronal apenas para Anexo IV
      if (anexoId === 'anexoIV') {
        campos.splice(3, 0, { label: 'CPP Patronal (20%)', campo: 'cppPatronal', classe: 'special' });
      }

      // Cria os cards para cada campo
      campos.forEach(field => {
        if (field.campo === 'cppPatronal' && (!resultado[field.campo] || resultado[field.campo] === 0)) {
          return; // Pula se CPP Patronal for zero
        }

        const card = document.createElement('div');
        card.className = 'result-card';
        if (field.classe === 'special') card.classList.add('special');

        const label = document.createElement('div');
        label.className = 'result-label';
        label.textContent = field.label;

        const value = document.createElement('div');
        value.className = 'result-value';
        if (field.classe && field.classe !== 'special') value.classList.add(field.classe);
        value.textContent = formatarMoeda(resultado[field.campo] || 0);

        card.appendChild(label);
        card.appendChild(value);
        container.appendChild(card);
      });

      // Card do total líquido
      const totalCard = document.createElement('div');
      totalCard.className = 'result-card total-card';

      const totalLabel = document.createElement('div');
      totalLabel.className = 'result-label';
      totalLabel.textContent = 'Total Líquido (Sócio)';

      const totalValue = document.createElement('div');
      totalValue.className = 'result-value';
      totalValue.textContent = formatarMoeda(resultado.totalLiquido || 0);

      totalCard.appendChild(totalLabel);
      totalCard.appendChild(totalValue);
      container.appendChild(totalCard);
    }

    /**
     * Atualiza a comparação do Fator R na aba específica.
     */
    function atualizarComparacaoFatorR(resultados) {
      const comparacaoEl = document.getElementById('comparacaoFatorR');
      if (!comparacaoEl) return;

      const totalLiquidoAnexoV = resultados.anexoV ? resultados.anexoV.totalLiquido : 0;
      const totalLiquidoAnexoVFatorR = resultados.anexoVFatorROtimizado ? resultados.anexoVFatorROtimizado.totalLiquido : 0;
      const diferenca = totalLiquidoAnexoVFatorR - totalLiquidoAnexoV;

      let texto = '';
      let classe = '';

      if (diferenca > 0) {
        texto = `Ganho de ${formatarMoeda(diferenca)} em relação ao Anexo V original`;
        classe = 'gain-value';
      } else if (diferenca < 0) {
        texto = `Perda de ${formatarMoeda(Math.abs(diferenca))} em relação ao Anexo V original`;
        classe = 'loss-value';
      } else {
        texto = 'Mesmo valor do Anexo V original';
        classe = 'zero-diff-value';
      }

      comparacaoEl.textContent = texto;
      comparacaoEl.className = classe;
    }

    /**
     * Função principal para calcular os valores e atualizar a interface.
     */
    function calcular() {
      const faturamento = parseFloat(document.getElementById("faturamento").value) || 0;
      const prolaboreUsuario = parseFloat(document.getElementById("prolabore").value) || 0;

      const percentualProlaboreUsuario = faturamento > 0 ? (prolaboreUsuario / faturamento) : 0;
      const fatorRAplicavelUsuario = percentualProlaboreUsuario >= 0.28 || Math.abs(percentualProlaboreUsuario - 0.28) < 0.0001;

      const prolaboreBaseParaFatorR = faturamento * 0.28;
      let prolaboreParaColunaFatorROtimizado;
      if (prolaboreUsuario > prolaboreBaseParaFatorR) {
          prolaboreParaColunaFatorROtimizado = prolaboreUsuario;
      } else {
          prolaboreParaColunaFatorROtimizado = prolaboreBaseParaFatorR;
      }
      prolaboreParaColunaFatorROtimizado = Math.max(0, prolaboreParaColunaFatorROtimizado);

      const resultados = {
        anexoI: calcularAnexoDetalhado(faturamento, prolaboreUsuario, ALIQUOTAS_SIMPLES.anexoI, "anexoI"),
        anexoIII: calcularAnexoDetalhado(faturamento, prolaboreUsuario, ALIQUOTAS_SIMPLES.anexoIII, "anexoIII"),
        anexoIV: calcularAnexoDetalhado(faturamento, prolaboreUsuario, ALIQUOTAS_SIMPLES.anexoIV, "anexoIV"),
        anexoV: calcularAnexoDetalhado(faturamento, prolaboreUsuario, ALIQUOTAS_SIMPLES.anexoV, "anexoV_original"),
        anexoVFatorROtimizado: calcularAnexoDetalhado(faturamento, prolaboreParaColunaFatorROtimizado, ALIQUOTAS_SIMPLES.anexoIII, "anexoVFatorROtimizado")
      };

      atualizarInterfaceAbas(resultados);
    }

    // Event listeners para os campos de entrada
    document.getElementById("opcaoMinimo").addEventListener('change', function() {
      const prolaboreInputEl = document.getElementById("prolabore");

      if (this.checked) {
        prolaboreInputEl.value = SALARIO_MINIMO.toFixed(2);
        prolaboreInputEl.setAttribute("readonly", true);
        prolaboreInputEl.style.backgroundColor = "#f2f2f2";
      } else {
        prolaboreInputEl.removeAttribute("readonly");
        prolaboreInputEl.style.backgroundColor = "white";
      }
      calcular();
    });

    document.getElementById("faturamento").addEventListener("input", calcular);

    document.getElementById("prolabore").addEventListener("input", () => {
        const prolaboreInputEl = document.getElementById("prolabore");
        const opcaoMinimoCheckbox = document.getElementById("opcaoMinimo");

        if (opcaoMinimoCheckbox.checked) {
            opcaoMinimoCheckbox.checked = false;
        }
        prolaboreInputEl.removeAttribute("readonly");
        prolaboreInputEl.style.backgroundColor = "white";
        calcular();
    });

    // Inicialização
    window.onload = function() {
      inicializarAbas();
      
      // Cálculo inicial com valores padrão
      calcular();
    };
  </script>
</body>
</html>